<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Biodesix TrialScout</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,300;0,400;0,500;0,600;1,400&family=Epilogue:wght@400;500;600;700;800;900&family=Lora:ital,wght@0,400;0,500;1,400&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg:        #f7f5f2;
  --bg2:       #edeae4;
  --surface:   #ffffff;
  --border:    #e0dbd2;
  --border2:   #c8c2b6;
  --ink:       #1a1816;
  --ink2:      #3c3830;
  --ink3:      #6b6560;
  --ink4:      #9c968e;
  /* Biodesix primary */
  --bdx-blue:  #004C97;
  /* Biodesix secondary palette */
  --bdx-navy:  #274868;
  --bdx-teal:  #03494B;
  --bdx-steel: #A1BCD9;
  /* Accent system */
  --accent:    #03494B;
  --accent-bg: #e8f4f4;
  --accent-bd: #9ecfd0;
  --accent2:   #274868;
  --accent2-bg:#edf1f7;
  --accent2-bd:#b0c4d8;
  --accent3:   #A1BCD9;
  --accent3-bg:#f0f5fa;
  --accent3-bd:#c8d8e8;
  --red:       #9b2c2c;
  --red-bg:    #fdf2f2;
  --red-bd:    #e8c0c0;
  --amber:     #92400e;
  --amber-bg:  #fffbeb;
  --amber-bd:  #e8d5a0;
  --blue:      #274868;
  --blue-bg:   #edf1f7;
  --blue-bd:   #b0c4d8;
  --slate:     #4a5060;
  --slate-bg:  #f0f1f4;
  --slate-bd:  #c8ccd8;
  --sidebar-w: 300px;
  --topbar-h:  64px;
}

body {
  font-family: 'Lora', Georgia, serif;
  background: var(--bg);
  color: var(--ink);
  height: 100vh;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

/* ‚îÄ‚îÄ Top bar ‚îÄ‚îÄ */
.topbar {
  height: var(--topbar-h);
  background: var(--ink);
  display: flex;
  align-items: center;
  padding: 0 28px;
  gap: 20px;
  flex-shrink: 0;
  border-bottom: 1px solid rgba(255,255,255,0.06);
}
.brand {
  display: flex;
  flex-direction: column;
  margin-right: 8px;
  flex-shrink: 0;
}
.brand-name {
  font-family: 'Epilogue', sans-serif;
  font-weight: 900;
  font-size: 17px;
  color: #fff;
  letter-spacing: -0.3px;
  line-height: 1;
}
.brand-name em { color: #004C97; font-style: normal; }
.brand-sub {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 8.5px;
  color: rgba(255,255,255,0.3);
  letter-spacing: 2.5px;
  text-transform: uppercase;
  margin-top: 3px;
}

.divider-v {
  width: 1px;
  height: 28px;
  background: rgba(255,255,255,0.1);
  flex-shrink: 0;
}

/* Search inputs in topbar */
.search-wrap {
  flex: 1;
  display: flex;
  gap: 10px;
  align-items: center;
}
.search-field {
  position: relative;
  flex: 1.6;
}
.search-field.narrow { flex: 1; }
.search-icon {
  position: absolute;
  left: 12px;
  top: 50%;
  transform: translateY(-50%);
  color: rgba(255,255,255,0.25);
  font-size: 14px;
  pointer-events: none;
}
.top-input {
  width: 100%;
  background: rgba(255,255,255,0.07);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 7px;
  color: #fff;
  font-family: 'Lora', serif;
  font-size: 13.5px;
  padding: 9px 32px 9px 34px;
  outline: none;
  transition: border-color 0.15s, background 0.15s;
}
.top-input::placeholder { color: rgba(255,255,255,0.28); font-style: italic; }
.top-input:focus { border-color: rgba(200,230,176,0.5); background: rgba(255,255,255,0.1); }

.btn-search {
  font-family: 'Epilogue', sans-serif;
  font-weight: 700;
  font-size: 13px;
  background: #004C97;
  color: #ffffff;
  border: none;
  border-radius: 7px;
  padding: 10px 22px;
  cursor: pointer;
  white-space: nowrap;
  transition: all 0.15s;
  flex-shrink: 0;
  letter-spacing: 0.2px;
}
.btn-search:hover { background: #003d7a; transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
.btn-search:disabled { opacity: 0.4; cursor: not-allowed; transform: none; box-shadow: none; }

/* ‚îÄ‚îÄ Body layout ‚îÄ‚îÄ */
.body-wrap {
  display: flex;
  flex: 1;
  overflow: hidden;
}

/* ‚îÄ‚îÄ Filter sidebar ‚îÄ‚îÄ */
.sidebar {
  width: var(--sidebar-w);
  flex-shrink: 0;
  background: var(--surface);
  border-right: 1px solid var(--border);
  overflow-y: auto;
  display: flex;
  flex-direction: column;
}

.sidebar-section {
  padding: 20px 20px 16px;
  border-bottom: 1px solid var(--border);
}
.sidebar-section:last-child { border-bottom: none; }

.filter-heading {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 9px;
  letter-spacing: 2.5px;
  text-transform: uppercase;
  color: var(--ink4);
  margin-bottom: 12px;
}

/* Status checkboxes */
.status-list { display: flex; flex-direction: column; gap: 4px; }
.status-item {
  display: flex;
  align-items: center;
  gap: 9px;
  padding: 6px 9px;
  border-radius: 6px;
  cursor: pointer;
  transition: background 0.1s;
  user-select: none;
}
.status-item:hover { background: var(--bg2); }
.status-item input[type="checkbox"] { display: none; }
.check-box {
  width: 16px; height: 16px;
  border-radius: 4px;
  border: 1.5px solid var(--border2);
  background: var(--bg);
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  transition: all 0.12s;
}
.status-item input:checked ~ .check-box {
  background: var(--bdx-navy);
  border-color: var(--bdx-navy);
}
.check-box::after {
  content: '';
  width: 8px; height: 5px;
  border-left: 2px solid #fff;
  border-bottom: 2px solid #fff;
  transform: rotate(-45deg) translateY(-1px);
  display: none;
}
.status-item input:checked ~ .check-box::after { display: block; }
.status-label {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 11px;
  color: var(--ink2);
  flex: 1;
}
.status-dot {
  width: 7px; height: 7px;
  border-radius: 50%;
  flex-shrink: 0;
}
.dot-RECRUITING { background: #2d7a4f; box-shadow: 0 0 5px rgba(45,122,79,0.4); }
.dot-NOT_YET_RECRUITING { background: #b07d20; }
.dot-ACTIVE_NOT_RECRUITING { background: #1e5fa0; }
.dot-COMPLETED { background: #7a8090; }
.dot-TERMINATED { background: #9b2c2c; }
.dot-WITHDRAWN { background: #c05050; }
.dot-SUSPENDED { background: #c08030; }

/* Phase filter */
.phase-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 5px;
}
.phase-btn {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 10px;
  padding: 7px 6px;
  border-radius: 5px;
  border: 1.5px solid var(--border);
  background: var(--bg);
  color: var(--ink3);
  cursor: pointer;
  text-align: center;
  transition: all 0.12s;
  letter-spacing: 0.3px;
}
.phase-btn:hover { border-color: var(--border2); color: var(--ink); }
.phase-btn.active { background: var(--bdx-navy); color: #fff; border-color: var(--bdx-navy); }

/* US toggle */
.toggle-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  cursor: pointer;
  padding: 4px 0;
}
.toggle-label {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 11px;
  color: var(--ink2);
}
.toggle {
  width: 36px; height: 20px;
  background: var(--border2);
  border-radius: 10px;
  position: relative;
  transition: background 0.15s;
  flex-shrink: 0;
}
.toggle.on { background: var(--bdx-teal); }
.toggle::after {
  content: '';
  position: absolute;
  width: 14px; height: 14px;
  background: #fff;
  border-radius: 50%;
  top: 3px; left: 3px;
  transition: transform 0.15s;
  box-shadow: 0 1px 3px rgba(0,0,0,0.2);
}
.toggle.on::after { transform: translateX(16px); }

/* Quick keywords */
.kw-grid { display: flex; flex-wrap: wrap; gap: 5px; }
.kw-tag {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 9.5px;
  padding: 4px 9px;
  border-radius: 4px;
  border: 1px solid var(--border);
  color: var(--ink3);
  cursor: pointer;
  background: var(--bg);
  transition: all 0.1s;
}
.kw-tag:hover { border-color: var(--accent); color: var(--accent); background: var(--accent-bg); }

/* Results count in sidebar */
.result-meta {
  padding: 14px 20px;
  background: var(--bg2);
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.result-count {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 11px;
  color: var(--ink2);
}
.result-count strong { color: var(--ink); }
.live-badge {
  display: flex;
  align-items: center;
  gap: 5px;
  font-family: 'IBM Plex Mono', monospace;
  font-size: 9px;
  color: var(--accent);
  letter-spacing: 1px;
}
.live-dot {
  width: 6px; height: 6px;
  background: var(--accent);
  border-radius: 50%;
  animation: blink 2s infinite;
}
@keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.3} }

/* ‚îÄ‚îÄ Main panel ‚îÄ‚îÄ */
.main-panel {
  flex: 1;
  overflow: hidden;
  display: flex;
}

/* Results list */
.results-list {
  width: 420px;
  flex-shrink: 0;
  overflow-y: auto;
  border-right: 1px solid var(--border);
  background: var(--bg);
}

.trial-card {
  padding: 16px 18px;
  border-bottom: 1px solid var(--border);
  cursor: pointer;
  transition: background 0.1s;
  position: relative;
  animation: fadeIn 0.2s ease forwards;
  opacity: 0;
}
@keyframes fadeIn { to { opacity: 1; } }
.trial-card:hover { background: var(--surface); }
.trial-card.active {
  background: var(--surface);
  border-left: 3px solid var(--bdx-blue);
}
.trial-card.active { padding-left: 15px; }

.card-top {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 8px;
  margin-bottom: 7px;
}
.card-nct {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 10px;
  color: var(--ink4);
  letter-spacing: 0.5px;
}
.card-title {
  font-family: 'Epilogue', sans-serif;
  font-size: 13px;
  font-weight: 600;
  color: var(--ink);
  line-height: 1.4;
  margin-bottom: 8px;
}
.card-chips { display: flex; gap: 5px; flex-wrap: wrap; margin-bottom: 8px; }
.chip {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 9px;
  padding: 2px 7px;
  border-radius: 3px;
  letter-spacing: 0.3px;
  white-space: nowrap;
}
.chip-RECRUITING        { background: var(--accent-bg); color: var(--accent); border: 1px solid var(--accent-bd); }
.chip-NOT_YET_RECRUITING{ background: var(--amber-bg); color: var(--amber); border: 1px solid var(--amber-bd); }
.chip-ACTIVE_NOT_RECRUITING { background: var(--blue-bg); color: var(--blue); border: 1px solid var(--blue-bd); }
.chip-COMPLETED         { background: var(--slate-bg); color: var(--slate); border: 1px solid var(--slate-bd); }
.chip-TERMINATED        { background: var(--red-bg); color: var(--red); border: 1px solid var(--red-bd); }
.chip-WITHDRAWN         { background: var(--red-bg); color: var(--red); border: 1px solid var(--red-bd); }
.chip-SUSPENDED         { background: var(--amber-bg); color: var(--amber); border: 1px solid var(--amber-bd); }
.chip-DEFAULT           { background: var(--slate-bg); color: var(--slate); border: 1px solid var(--slate-bd); }
.chip-phase { background: var(--bg2); color: var(--ink3); border: 1px solid var(--border); }
.chip-industry { background: #f0f5e8; color: #2d5a20; border: 1px solid #b8d4a0; }
.chip-academic { background: var(--blue-bg); color: var(--blue); border: 1px solid var(--blue-bd); }
.chip-other { background: var(--slate-bg); color: var(--slate); border: 1px solid var(--slate-bd); }

.card-sponsor {
  font-family: 'Epilogue', sans-serif;
  font-size: 12px;
  font-weight: 600;
  color: var(--ink2);
  margin-bottom: 5px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.card-meta-row {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
}
.card-meta-item {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 10px;
  color: var(--ink4);
  display: flex;
  align-items: center;
  gap: 4px;
}
.card-meta-item svg { flex-shrink: 0; }

/* ‚îÄ‚îÄ Detail panel ‚îÄ‚îÄ */
.detail-panel {
  flex: 1;
  overflow-y: auto;
  background: var(--surface);
}

.detail-empty {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
  gap: 12px;
  color: var(--ink4);
  text-align: center;
  padding: 40px;
}
.detail-empty-icon { font-size: 36px; opacity: 0.3; }
.detail-empty-text {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 11px;
  letter-spacing: 1px;
  text-transform: uppercase;
}

.detail-loading {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100%;
  gap: 12px;
  color: var(--ink4);
  font-family: 'IBM Plex Mono', monospace;
  font-size: 11px;
}
.spinner {
  width: 18px; height: 18px;
  border: 2px solid var(--border);
  border-top-color: var(--ink);
  border-radius: 50%;
  animation: spin 0.7s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }

.detail-inner { padding: 32px 36px; max-width: 800px; }

.detail-header { margin-bottom: 24px; }
.detail-nct {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 11px;
  color: var(--ink4);
  margin-bottom: 8px;
  letter-spacing: 0.5px;
}
.detail-title {
  font-family: 'Epilogue', sans-serif;
  font-size: 22px;
  font-weight: 800;
  color: var(--ink);
  line-height: 1.3;
  margin-bottom: 12px;
  letter-spacing: -0.3px;
}
.detail-chips { display: flex; gap: 6px; flex-wrap: wrap; }

/* Data grid */
.data-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 1px;
  background: var(--border);
  border: 1px solid var(--border);
  border-radius: 8px;
  overflow: hidden;
  margin: 20px 0;
}
.data-cell {
  background: var(--surface);
  padding: 12px 16px;
}
.dc-label {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 8.5px;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--ink4);
  margin-bottom: 5px;
}
.dc-value {
  font-family: 'Epilogue', sans-serif;
  font-size: 14px;
  font-weight: 600;
  color: var(--ink2);
  line-height: 1.3;
}

/* Section blocks */
.detail-section { margin-bottom: 28px; }
.section-heading {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 9px;
  letter-spacing: 3px;
  text-transform: uppercase;
  color: var(--ink4);
  margin-bottom: 14px;
  padding-bottom: 8px;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  gap: 8px;
}
.section-heading::before {
  content: '';
  width: 3px; height: 3px;
  background: var(--bdx-navy);
  border-radius: 50%;
}

/* Contact cards */
.contact-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
.contact-card {
  background: var(--bg2);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 14px 16px;
}
.contact-role {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 8px;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--ink4);
  margin-bottom: 6px;
}
.contact-name {
  font-family: 'Epilogue', sans-serif;
  font-size: 14px;
  font-weight: 700;
  color: var(--ink);
  margin-bottom: 4px;
}
.contact-affil {
  font-family: 'Lora', serif;
  font-size: 12px;
  font-style: italic;
  color: var(--ink3);
  margin-bottom: 8px;
}
.contact-detail {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 11px;
  color: var(--ink2);
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 3px;
}
.contact-detail a { color: var(--accent); text-decoration: none; }
.contact-detail a:hover { text-decoration: underline; }

/* Criteria / description text */
.criteria-text {
  font-family: 'Lora', serif;
  font-size: 13.5px;
  line-height: 1.8;
  color: var(--ink2);
  white-space: pre-wrap;
  background: var(--bg2);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 16px 18px;
  max-height: 300px;
  overflow-y: auto;
}
.criteria-text mark {
  background: #fef3a0;
  border-radius: 2px;
  padding: 0 2px;
}

/* Outcome list */
.outcome-item {
  padding: 10px 14px;
  border-left: 2px solid var(--border);
  margin-bottom: 8px;
}
.outcome-item.primary { border-left-color: var(--ink); }
.outcome-type {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 8.5px;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  color: var(--ink4);
  margin-bottom: 4px;
}
.outcome-measure {
  font-family: 'Epilogue', sans-serif;
  font-size: 13px;
  font-weight: 600;
  color: var(--ink);
  margin-bottom: 3px;
}
.outcome-time {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 10px;
  color: var(--ink4);
}

/* Locations */
.locations-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; }
.location-item {
  background: var(--bg2);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 10px 13px;
  font-size: 12px;
}
.loc-facility {
  font-family: 'Epilogue', sans-serif;
  font-size: 12px;
  font-weight: 600;
  color: var(--ink2);
  margin-bottom: 3px;
}
.loc-city {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 10px;
  color: var(--ink4);
}
.loc-contact {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 10px;
  color: var(--ink3);
  margin-top: 4px;
}

.more-locations {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 10px;
  color: var(--ink4);
  padding: 8px 4px;
}

/* External link */
.ext-link {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-family: 'IBM Plex Mono', monospace;
  font-size: 10px;
  letter-spacing: 1px;
  color: var(--accent);
  text-decoration: none;
  border: 1px solid var(--accent-bd);
  padding: 7px 14px;
  border-radius: 5px;
  background: var(--accent-bg);
  transition: all 0.1s;
  margin-top: 4px;
}
.ext-link:hover { background: #ddf0e5; }

/* Empty / state */
.state-box {
  padding: 60px 32px;
  text-align: center;
  color: var(--ink4);
}
.state-icon { font-size: 32px; margin-bottom: 14px; opacity: 0.4; }
.state-title {
  font-family: 'Epilogue', sans-serif;
  font-size: 15px;
  font-weight: 700;
  color: var(--ink3);
  margin-bottom: 6px;
}
.state-sub {
  font-family: 'Lora', serif;
  font-size: 13px;
  font-style: italic;
  color: var(--ink4);
  line-height: 1.6;
}

/* Load more */
.load-more-wrap { padding: 16px 18px; text-align: center; }
.btn-load-more {
  font-family: 'IBM Plex Mono', monospace;
  font-size: 10px;
  letter-spacing: 1px;
  color: var(--ink3);
  background: var(--surface);
  border: 1px solid var(--border2);
  padding: 9px 24px;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.1s;
}
.btn-load-more:hover { border-color: var(--ink); color: var(--ink); }

/* Tooltips */
.tooltip-wrap {
  position: relative;
  display: inline-flex;
  align-items: center;
}
.tooltip-icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 14px; height: 14px;
  border-radius: 50%;
  background: rgba(255,255,255,0.15);
  color: rgba(255,255,255,0.5);
  font-size: 9px;
  font-family: 'IBM Plex Mono', monospace;
  font-style: normal;
  cursor: help;
  margin-left: 6px;
  flex-shrink: 0;
  transition: background 0.15s, color 0.15s;
}
.tooltip-icon:hover { background: rgba(255,255,255,0.25); color: #fff; }
.tooltip-bubble {
  display: none;
  position: absolute;
  top: calc(100% + 8px);
  left: 0;
  background: #1a1816;
  color: rgba(255,255,255,0.85);
  font-family: 'IBM Plex Mono', monospace;
  font-size: 10px;
  line-height: 1.6;
  padding: 10px 13px;
  border-radius: 6px;
  width: 240px;
  z-index: 100;
  box-shadow: 0 6px 20px rgba(0,0,0,0.35);
  pointer-events: none;
  border: 1px solid rgba(255,255,255,0.08);
}
.tooltip-bubble::before {
  content: '';
  position: absolute;
  top: -5px; left: 14px;
  width: 8px; height: 8px;
  background: #1a1816;
  border-left: 1px solid rgba(255,255,255,0.08);
  border-top: 1px solid rgba(255,255,255,0.08);
  transform: rotate(45deg);
}
/* Right-edge variant ‚Äî opens leftward */
.tooltip-bubble-left {
  left: auto;
  right: 0;
}
.tooltip-bubble-left::before {
  left: auto;
  right: 14px;
}
.tooltip-wrap:hover .tooltip-bubble { display: block; }

/* Clear button */
.btn-clear {
  font-family: 'Epilogue', sans-serif;
  font-weight: 600;
  font-size: 13px;
  background: transparent;
  color: rgba(255,255,255,0.45);
  border: 1px solid rgba(255,255,255,0.15);
  border-radius: 7px;
  padding: 10px 16px;
  cursor: pointer;
  white-space: nowrap;
  transition: all 0.15s;
  flex-shrink: 0;
}
.btn-clear:hover { color: rgba(255,255,255,0.85); border-color: rgba(255,255,255,0.35); }

/* Scrollbars */
::-webkit-scrollbar { width: 5px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 4px; }
</style>
</head>
<body>

<!-- ‚îÄ‚îÄ Top bar ‚îÄ‚îÄ -->
<div class="topbar">
  <div class="brand">
    <div class="brand-name">Biodesix <em>TrialScout</em></div>
    <div class="brand-sub">Biopharma Services</div>
  </div>
  <div class="divider-v"></div>
  <div class="search-wrap">
    <div class="search-field">
      <span class="search-icon">‚åï</span>
      <input class="top-input" id="kwInput" type="text"
        placeholder="Keyword ‚Äî EGFR, ESR1, proteomics, biomarker, liquid biopsy‚Ä¶"
        onkeydown="if(event.key==='Enter')doSearch()">
      <span class="tooltip-wrap" style="position:absolute;right:10px;top:50%;transform:translateY(-50%);">
        <span class="tooltip-icon">?</span>
        <span class="tooltip-bubble">Searches the <strong style="color:#fff">full text</strong> of every trial ‚Äî including eligibility criteria, outcome measures, protocol descriptions, and intervention names. Best for biomarker targets like EGFR, ESR1, proteomics, ctDNA.</span>
      </span>
    </div>
    <div class="search-field narrow">
      <span class="search-icon" style="font-size:12px">‚óé</span>
      <input class="top-input" id="condInput" type="text"
        placeholder="Condition (optional) ‚Äî lung cancer‚Ä¶"
        onkeydown="if(event.key==='Enter')doSearch()">
      <span class="tooltip-wrap" style="position:absolute;right:10px;top:50%;transform:translateY(-50%);">
        <span class="tooltip-icon">?</span>
        <span class="tooltip-bubble tooltip-bubble-left">Searches only the <strong style="color:#fff">official condition fields</strong> that sponsors tag their trial with at registration ‚Äî mapped to standardized MeSH disease terms. Use this to narrow by disease area, e.g. "lung cancer" or "breast neoplasm."</span>
      </span>
    </div>
    <button class="btn-search" id="searchBtn" onclick="doSearch()">Search</button>
    <button class="btn-clear" onclick="clearSearch()">Clear</button>
  </div>
</div>

<!-- ‚îÄ‚îÄ Body ‚îÄ‚îÄ -->
<div class="body-wrap">

  <!-- ‚îÄ‚îÄ Sidebar / filters ‚îÄ‚îÄ -->
  <div class="sidebar">

    <!-- Status -->
    <div class="sidebar-section">
      <div class="filter-heading">Trial Status</div>
      <div class="status-list" id="statusFilters">
        <!-- built by JS -->
      </div>
    </div>

    <!-- Phase -->
    <div class="sidebar-section">
      <div class="filter-heading">Phase</div>
      <div class="phase-grid" id="phaseGrid">
        <!-- built by JS -->
      </div>
    </div>

    <!-- US only toggle -->
    <div class="sidebar-section">
      <div class="filter-heading">Geography</div>
      <div class="toggle-row" onclick="toggleUS()">
        <span class="toggle-label">US Trials Only</span>
        <div class="toggle" id="usToggle"></div>
      </div>
    </div>

    <!-- Quick keywords -->
    <div class="sidebar-section">
      <div class="filter-heading">Quick Keywords</div>
      <div class="kw-grid">
        <span class="kw-tag" onclick="quickKw('EGFR')">EGFR</span>
        <span class="kw-tag" onclick="quickKw('ESR1')">ESR1</span>
        <span class="kw-tag" onclick="quickKw('KRAS')">KRAS</span>
        <span class="kw-tag" onclick="quickKw('ALK')">ALK</span>
        <span class="kw-tag" onclick="quickKw('PD-L1')">PD-L1</span>
        <span class="kw-tag" onclick="quickKw('HER2')">HER2</span>
        <span class="kw-tag" onclick="quickKw('proteomics')">Proteomics</span>
        <span class="kw-tag" onclick="quickKw('genomics')">Genomics</span>
        <span class="kw-tag" onclick="quickKw('biomarker')">Biomarker</span>
        <span class="kw-tag" onclick="quickKw('liquid biopsy')">Liquid Biopsy</span>
        <span class="kw-tag" onclick="quickKw('ctDNA')">ctDNA</span>
        <span class="kw-tag" onclick="quickKw('protein expression')">Protein Expression</span>
        <span class="kw-tag" onclick="quickKw('companion diagnostic')">CDx</span>
        <span class="kw-tag" onclick="quickKw('mass spectrometry')">Mass Spec</span>
        <span class="kw-tag" onclick="quickKw('gene expression')">Gene Expression</span>
        <span class="kw-tag" onclick="quickKw('next generation sequencing')">NGS</span>
      </div>
    </div>

  </div><!-- /sidebar -->

  <!-- ‚îÄ‚îÄ Main panel ‚îÄ‚îÄ -->
  <div class="main-panel">

    <!-- Results list -->
    <div class="results-list" id="resultsList">
      <div class="state-box">
        <div class="state-icon">üî¨</div>
        <div class="state-title">Search for leads</div>
        <div class="state-sub">Enter a biomarker keyword above ‚Äî EGFR, ESR1, proteomics ‚Äî or pick a quick keyword from the sidebar.</div>
      </div>
    </div>

    <!-- Detail panel -->
    <div class="detail-panel" id="detailPanel">
      <div class="detail-empty">
        <div class="detail-empty-icon">‚ó±</div>
        <div class="detail-empty-text">Select a trial to view details</div>
      </div>
    </div>

  </div><!-- /main-panel -->

</div><!-- /body-wrap -->

<script>
// ‚îÄ‚îÄ State ‚îÄ‚îÄ
const STATUSES = [
  { key: 'RECRUITING',           label: 'Recruiting',              default: true },
  { key: 'NOT_YET_RECRUITING',   label: 'Not Yet Recruiting',      default: true },
  { key: 'ACTIVE_NOT_RECRUITING',label: 'Active, Not Recruiting',  default: false },
  { key: 'COMPLETED',            label: 'Completed',               default: false },
  { key: 'TERMINATED',           label: 'Terminated',              default: false },
  { key: 'WITHDRAWN',            label: 'Withdrawn',               default: false },
  { key: 'SUSPENDED',            label: 'Suspended',               default: false },
];
const PHASES = [
  { key: 'EARLY_PHASE1', label: 'Early Ph 1' },
  { key: 'PHASE1',       label: 'Phase 1' },
  { key: 'PHASE2',       label: 'Phase 2' },
  { key: 'PHASE3',       label: 'Phase 3' },
  { key: 'PHASE4',       label: 'Phase 4' },
  { key: 'NA',           label: 'N/A' },
];

let selectedPhases = new Set();
let usOnly = true;
let results = [];
let nextPageToken = null;
let totalCount = 0;
let activeNCT = null;
let lastQuery = {};

// ‚îÄ‚îÄ Build sidebar ‚îÄ‚îÄ
function buildSidebar() {
  // Status checkboxes
  const sf = document.getElementById('statusFilters');
  sf.innerHTML = STATUSES.map(s => `
    <label class="status-item">
      <input type="checkbox" data-status="${s.key}" ${s.default ? 'checked' : ''}>
      <div class="check-box"></div>
      <span class="status-dot dot-${s.key}"></span>
      <span class="status-label">${s.label}</span>
    </label>`).join('');

  // Phase buttons
  const pg = document.getElementById('phaseGrid');
  pg.innerHTML = PHASES.map(p => `
    <div class="phase-btn" data-phase="${p.key}" onclick="togglePhase('${p.key}',this)">${p.label}</div>`).join('');
}

function togglePhase(key, el) {
  if (selectedPhases.has(key)) { selectedPhases.delete(key); el.classList.remove('active'); }
  else { selectedPhases.add(key); el.classList.add('active'); }
}

function toggleUS() {
  usOnly = !usOnly;
  document.getElementById('usToggle').classList.toggle('on', usOnly);
}

function quickKw(kw) {
  document.getElementById('kwInput').value = kw;
  document.getElementById('condInput').value = '';
  doSearch();
}

function getCheckedStatuses() {
  return [...document.querySelectorAll('#statusFilters input:checked')].map(i => i.dataset.status);
}

// ‚îÄ‚îÄ Search ‚îÄ‚îÄ
async function doSearch(append = false) {
  const kw   = document.getElementById('kwInput').value.trim();
  const cond = document.getElementById('condInput').value.trim();
  if (!kw && !cond) { alert('Please enter a keyword or condition.'); return; }

  const statuses = getCheckedStatuses();

  if (!append) {
    results = [];
    nextPageToken = null;
    activeNCT = null;
    document.getElementById('detailPanel').innerHTML = `<div class="detail-empty"><div class="detail-empty-icon">‚ó±</div><div class="detail-empty-text">Select a trial to view details</div></div>`;
    document.getElementById('resultsList').innerHTML = `<div class="detail-loading"><div class="spinner"></div> Searching‚Ä¶</div>`;
  }

  setSearching(true);

  const params = new URLSearchParams();
  if (kw)   params.set('query.term', kw);
  if (cond) params.set('query.cond', cond);
  if (statuses.length) params.set('filter.overallStatus', statuses.join(','));
  if (selectedPhases.size) {
    params.set('filter.advanced', [...selectedPhases].map(p => `AREA[Phase]${p}`).join(' OR '));
  }
  if (usOnly) params.set('filter.geo', 'distance(39.5,-98.35,1500mi)');
  if (nextPageToken && append) params.set('pageToken', nextPageToken);
  params.set('pageSize', '20');
  params.set('countTotal', 'true');
  params.set('format', 'json');

  // Request fields needed for list view
  params.set('fields', [
    'NCTId','BriefTitle','OverallStatus','Phase','Condition',
    'LeadSponsorName','LeadSponsorClass',
    'CentralContactName','CentralContactPhone','CentralContactEMail',
    'OverallOfficialName','OverallOfficialAffiliation',
    'EnrollmentCount','StartDate','PrimaryCompletionDate',
    'StudyType','LocationCity','LocationState','LocationCountry','LocationFacility',
    'LocationContactName','LocationContactPhone','LocationContactEMail'
  ].join(','));

  lastQuery = { kw, cond, statuses };

  try {
    const res = await fetch(`https://clinicaltrials.gov/api/v2/studies?${params}`);
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const data = await res.json();

    nextPageToken = data.nextPageToken || null;
    totalCount = data.totalCount || 0;
    results = append ? [...results, ...(data.studies || [])] : (data.studies || []);

    renderList(kw);
  } catch(e) {
    document.getElementById('resultsList').innerHTML =
      `<div class="state-box"><div class="state-icon">‚ö†</div><div class="state-title">Request failed</div><div class="state-sub">${e.message}</div></div>`;
  }
  setSearching(false);
}

function setSearching(on) {
  const btn = document.getElementById('searchBtn');
  btn.disabled = on;
  btn.textContent = on ? 'Searching‚Ä¶' : 'Search';
}

// ‚îÄ‚îÄ Render results list ‚îÄ‚îÄ
function renderList(kw) {
  const list = document.getElementById('resultsList');

  if (!results.length) {
    list.innerHTML = `<div class="state-box"><div class="state-icon">üîç</div><div class="state-title">No trials found</div><div class="state-sub">Try different keywords or adjust your status filters.</div></div>`;
    return;
  }

  const header = `
    <div style="padding:12px 18px 10px;border-bottom:1px solid var(--border);background:var(--surface);position:sticky;top:0;z-index:5;display:flex;align-items:center;justify-content:space-between;">
      <span style="font-family:'IBM Plex Mono',monospace;font-size:10px;color:var(--ink3);">
        <strong style="color:var(--ink)">${totalCount.toLocaleString()}</strong> trials &mdash; showing ${results.length}
      </span>
      <span class="live-badge"><span class="live-dot"></span>LIVE</span>
    </div>`;

  const cards = results.map((s, i) => buildCard(s, i)).join('');

  const loadMore = nextPageToken
    ? `<div class="load-more-wrap"><button class="btn-load-more" onclick="doSearch(true)">Load more results ‚Üí</button></div>`
    : '';

  list.innerHTML = header + `<div>${cards}</div>` + loadMore;
}

function buildCard(s, idx) {
  const p   = s.protocolSection || {};
  const id  = p.identificationModule || {};
  const st  = p.statusModule || {};
  const sp  = p.sponsorCollaboratorsModule || {};
  const des = p.designModule || {};
  const cl  = p.contactsLocationsModule || {};
  const co  = p.conditionsModule || {};

  const nct    = id.nctId || '‚Äî';
  const title  = id.briefTitle || 'Untitled';
  const status = st.overallStatus || 'UNKNOWN';
  const phases = (des.phases || []).map(ph => ph.replace('_',' ')).join(', ') || null;
  const sponsor     = (sp.leadSponsor || {}).name || '‚Äî';
  const sponsorType = (sp.leadSponsor || {}).class || 'OTHER'; // INDUSTRY | NIH | OTHER

  const sponsorChip = sponsorType === 'INDUSTRY' ? 'chip-industry'
                    : (sponsorType === 'NIH' || sponsorType === 'FED' || sponsorType === 'NETWORK') ? 'chip-academic'
                    : 'chip-other';
  const sponsorLabel = sponsorType === 'INDUSTRY' ? 'Industry'
                     : (sponsorType === 'NIH' || sponsorType === 'FED') ? 'NIH/Gov'
                     : sponsorType === 'NETWORK' ? 'Network'
                     : 'Academic/Other';

  // Contacts
  const central = (cl.centralContacts || [])[0] || {};
  const official = (cl.overallOfficials || [])[0] || {};
  const hasContact = central.name || official.name;

  // Locations ‚Äî dedupe cities
  const locs = cl.locations || [];
  const cities = [...new Set(locs.map(l => [l.city, l.state || l.country].filter(Boolean).join(', ')))].slice(0, 3);
  const siteCount = locs.length;

  const statusChipClass = {
    'RECRUITING':'chip-RECRUITING','NOT_YET_RECRUITING':'chip-NOT_YET_RECRUITING',
    'ACTIVE_NOT_RECRUITING':'chip-ACTIVE_NOT_RECRUITING','COMPLETED':'chip-COMPLETED',
    'TERMINATED':'chip-TERMINATED','WITHDRAWN':'chip-WITHDRAWN','SUSPENDED':'chip-SUSPENDED'
  }[status] || 'chip-DEFAULT';
  const statusLabel = status.replace(/_/g,' ');

  const animDelay = `animation-delay:${Math.min(idx*25,400)}ms`;

  const contactSnippet = central.name
    ? `<span>${central.name}${central.email ? ` &middot; ${central.email}` : ''}</span>`
    : official.name
    ? `<span>PI: ${official.name}</span>`
    : `<span style="color:var(--ink4);font-style:italic">No contact listed</span>`;

  const locSnippet = cities.length
    ? cities.join(' &middot; ') + (siteCount > 3 ? ` +${siteCount-3} more` : '')
    : '‚Äî';

  return `
  <div class="trial-card ${activeNCT===nct?'active':''}" style="${animDelay}" onclick="selectTrial('${nct}',this)">
    <div class="card-top">
      <span class="card-nct">${nct}</span>
    </div>
    <div class="card-title">${esc(title)}</div>
    <div class="card-chips">
      <span class="chip ${statusChipClass}">${statusLabel}</span>
      ${phases ? `<span class="chip chip-phase">${phases}</span>` : ''}
      <span class="chip ${sponsorChip}">${sponsorLabel}</span>
    </div>
    <div class="card-sponsor">${esc(sponsor)}</div>
    <div class="card-meta-row">
      <span class="card-meta-item">
        <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
        ${contactSnippet}
      </span>
    </div>
    <div class="card-meta-row" style="margin-top:4px">
      <span class="card-meta-item">
        <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
        ${locSnippet}
      </span>
    </div>
  </div>`;
}

// ‚îÄ‚îÄ Select trial ‚Üí fetch full detail ‚îÄ‚îÄ
async function selectTrial(nct, el) {
  // Update active card styling
  document.querySelectorAll('.trial-card').forEach(c => c.classList.remove('active'));
  el.classList.add('active');
  activeNCT = nct;

  document.getElementById('detailPanel').innerHTML =
    `<div class="detail-loading"><div class="spinner"></div> Loading full record‚Ä¶</div>`;

  try {
    const res = await fetch(`https://clinicaltrials.gov/api/v2/studies/${nct}?format=json`);
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const data = await res.json();
    renderDetail(data, lastQuery.kw || '');
  } catch(e) {
    document.getElementById('detailPanel').innerHTML =
      `<div class="state-box"><div class="state-icon">‚ö†</div><div class="state-title">Failed to load</div><div class="state-sub">${e.message}</div></div>`;
  }
}

function renderDetail(data, kw) {
  const p   = data.protocolSection || {};
  const id  = p.identificationModule || {};
  const st  = p.statusModule || {};
  const sp  = p.sponsorCollaboratorsModule || {};
  const des = p.designModule || {};
  const cl  = p.contactsLocationsModule || {};
  const co  = p.conditionsModule || {};
  const desc = p.descriptionModule || {};
  const elig = p.eligibilityModule || {};
  const arms = p.armsInterventionsModule || {};
  const out  = p.outcomesModule || {};

  const nct    = id.nctId || '‚Äî';
  const title  = id.briefTitle || 'Untitled';
  const status = st.overallStatus || 'UNKNOWN';
  const phases = (des.phases || []).map(ph => ph.replace(/_/g,' ')).join(', ') || 'N/A';
  const sponsor     = (sp.leadSponsor || {}).name || '‚Äî';
  const sponsorType = (sp.leadSponsor || {}).class || 'OTHER';
  const enrollment  = (des.enrollmentInfo || {}).count;
  const studyType   = des.studyType || '‚Äî';
  const startDate   = st.startDateStruct ? st.startDateStruct.date : '‚Äî';
  const compDate    = st.primaryCompletionDateStruct ? st.primaryCompletionDateStruct.date : '‚Äî';

  const statusChipClass = {
    'RECRUITING':'chip-RECRUITING','NOT_YET_RECRUITING':'chip-NOT_YET_RECRUITING',
    'ACTIVE_NOT_RECRUITING':'chip-ACTIVE_NOT_RECRUITING','COMPLETED':'chip-COMPLETED',
    'TERMINATED':'chip-TERMINATED','WITHDRAWN':'chip-WITHDRAWN','SUSPENDED':'chip-SUSPENDED'
  }[status] || 'chip-DEFAULT';
  const statusLabel = status.replace(/_/g,' ');

  const sponsorChip  = sponsorType==='INDUSTRY'?'chip-industry':(sponsorType==='NIH'||sponsorType==='FED'||sponsorType==='NETWORK')?'chip-academic':'chip-other';
  const sponsorLabel = sponsorType==='INDUSTRY'?'Industry':(sponsorType==='NIH'||sponsorType==='FED')?'NIH/Gov':sponsorType==='NETWORK'?'Network':'Academic/Other';

  // Contacts
  const central  = cl.centralContacts || [];
  const officials = cl.overallOfficials || [];
  const locs     = cl.locations || [];
  const collabs  = sp.collaborators || [];

  // Highlight kw in text
  function highlight(text) {
    if (!text) return '‚Äî';
    if (!kw) return esc(text);
    const escaped = esc(text);
    const regex = new RegExp(`(${kw.replace(/[.*+?^${}()|[\]\\]/g,'\\$&')})`, 'gi');
    return escaped.replace(regex, '<mark>$1</mark>');
  }

  // Outcomes
  const primaryOut   = (out.primaryOutcomes || []);
  const secondaryOut = (out.secondaryOutcomes || []).slice(0, 6);

  // Interventions
  const interventions = (arms.interventions || []).slice(0, 6);

  // Locations ‚Äî show up to 10, then "and N more"
  const locShow = locs.slice(0, 12);
  const locMore = locs.length > 12 ? locs.length - 12 : 0;

  const html = `
  <div class="detail-inner">

    <!-- Header -->
    <div class="detail-header">
      <div class="detail-nct">${nct} &middot; Last updated ${st.lastUpdatePostDateStruct ? st.lastUpdatePostDateStruct.date : '‚Äî'}</div>
      <div class="detail-title">${esc(title)}</div>
      <div class="detail-chips">
        <span class="chip ${statusChipClass}">${statusLabel}</span>
        <span class="chip chip-phase">${phases}</span>
        <span class="chip ${sponsorChip}">${sponsorLabel}</span>
      </div>
    </div>

    <!-- Data grid -->
    <div class="data-grid">
      <div class="data-cell">
        <div class="dc-label">Lead Sponsor</div>
        <div class="dc-value">${esc(sponsor)}</div>
      </div>
      <div class="data-cell">
        <div class="dc-label">Study Type</div>
        <div class="dc-value">${esc(studyType)}</div>
      </div>
      <div class="data-cell">
        <div class="dc-label">Enrollment</div>
        <div class="dc-value">${enrollment ? enrollment.toLocaleString()+' participants' : '‚Äî'}</div>
      </div>
      <div class="data-cell">
        <div class="dc-label">Start Date</div>
        <div class="dc-value">${esc(startDate)}</div>
      </div>
      <div class="data-cell">
        <div class="dc-label">Primary Completion</div>
        <div class="dc-value">${esc(compDate)}</div>
      </div>
      <div class="data-cell">
        <div class="dc-label">Sites</div>
        <div class="dc-value">${locs.length || '‚Äî'}</div>
      </div>
    </div>

    <!-- Contacts -->
    <div class="detail-section">
      <div class="section-heading">Contacts</div>
      <div class="contact-grid">
        ${central.map(c => `
          <div class="contact-card">
            <div class="contact-role">Central Contact</div>
            <div class="contact-name">${esc(c.name || '‚Äî')}</div>
            ${c.phone ? `<div class="contact-detail">
              <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07A19.5 19.5 0 0 1 4.69 13a19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 3.6 2.27h3a2 2 0 0 1 2 1.72c.127.96.361 1.903.7 2.81a2 2 0 0 1-.45 2.11L7.91 9.91a16 16 0 0 0 6 6l.92-.92a2 2 0 0 1 2.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0 1 21.73 17z"/></svg>
              ${esc(c.phone)}</div>` : ''}
            ${c.email ? `<div class="contact-detail">
              <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>
              <a href="mailto:${esc(c.email)}">${esc(c.email)}</a></div>` : ''}
          </div>`).join('')}
        ${officials.map(o => `
          <div class="contact-card">
            <div class="contact-role">Principal Investigator</div>
            <div class="contact-name">${esc(o.name || '‚Äî')}</div>
            <div class="contact-affil">${esc(o.affiliation || '')}</div>
            <div class="contact-detail" style="color:var(--ink4);font-style:italic">${esc(o.role || '')}</div>
          </div>`).join('')}
        ${!central.length && !officials.length ? '<div style="font-family:\'IBM Plex Mono\',monospace;font-size:11px;color:var(--ink4);font-style:italic;padding:8px 0;">No contacts listed for this trial.</div>' : ''}
      </div>
      ${collabs.length ? `<div style="margin-top:12px;font-family:'IBM Plex Mono',monospace;font-size:10px;color:var(--ink4);">Collaborators: ${collabs.map(c=>esc(c.name)).join(' &middot; ')}</div>` : ''}
    </div>

    <!-- Brief summary -->
    ${desc.briefSummary ? `
    <div class="detail-section">
      <div class="section-heading">Summary</div>
      <div class="criteria-text" style="max-height:180px">${highlight(desc.briefSummary)}</div>
    </div>` : ''}

    <!-- Eligibility criteria ‚Äî key for biomarker signals -->
    ${elig.eligibilityCriteria ? `
    <div class="detail-section">
      <div class="section-heading">Eligibility Criteria ${kw ? '<span style="margin-left:8px;background:#fef3a0;border-radius:3px;padding:2px 8px;font-size:9px;color:#7a6800;">keyword highlighted</span>' : ''}</div>
      <div class="criteria-text">${highlight(elig.eligibilityCriteria)}</div>
    </div>` : ''}

    <!-- Interventions -->
    ${interventions.length ? `
    <div class="detail-section">
      <div class="section-heading">Interventions</div>
      ${interventions.map(iv => `
        <div class="outcome-item">
          <div class="outcome-type">${esc(iv.type || '')}</div>
          <div class="outcome-measure">${esc(iv.name || '')}</div>
          ${iv.description ? `<div class="outcome-time" style="font-style:italic;margin-top:3px;font-size:11px;color:var(--ink3)">${esc(iv.description.substring(0,200))}${iv.description.length>200?'‚Ä¶':''}</div>` : ''}
        </div>`).join('')}
    </div>` : ''}

    <!-- Outcomes -->
    ${(primaryOut.length || secondaryOut.length) ? `
    <div class="detail-section">
      <div class="section-heading">Outcome Measures</div>
      ${primaryOut.map(o => `
        <div class="outcome-item primary">
          <div class="outcome-type">Primary</div>
          <div class="outcome-measure">${highlight(o.measure || '')}</div>
          ${o.timeFrame ? `<div class="outcome-time">${esc(o.timeFrame)}</div>` : ''}
        </div>`).join('')}
      ${secondaryOut.map(o => `
        <div class="outcome-item">
          <div class="outcome-type">Secondary</div>
          <div class="outcome-measure">${highlight(o.measure || '')}</div>
          ${o.timeFrame ? `<div class="outcome-time">${esc(o.timeFrame)}</div>` : ''}
        </div>`).join('')}
      ${(out.secondaryOutcomes||[]).length > 6 ? `<div class="more-locations">+${(out.secondaryOutcomes||[]).length-6} more secondary outcomes ‚Äî view on ClinicalTrials.gov</div>` : ''}
    </div>` : ''}

    <!-- Locations -->
    ${locs.length ? `
    <div class="detail-section">
      <div class="section-heading">Trial Locations (${locs.length})</div>
      <div class="locations-grid">
        ${locShow.map(l => `
          <div class="location-item">
            <div class="loc-facility">${esc(l.facility || l.city || '‚Äî')}</div>
            <div class="loc-city">${[l.city, l.state, l.country].filter(Boolean).join(', ')}</div>
            ${l.contacts && l.contacts[0] ? `<div class="loc-contact">${esc(l.contacts[0].name||'')}${l.contacts[0].email?' &middot; '+esc(l.contacts[0].email):''}</div>` : ''}
          </div>`).join('')}
      </div>
      ${locMore ? `<div class="more-locations">+ ${locMore} additional sites ‚Äî view all on ClinicalTrials.gov</div>` : ''}
    </div>` : ''}

    <!-- Conditions -->
    <div class="detail-section">
      <div class="section-heading">Conditions Studied</div>
      <div class="card-chips">
        ${(co.conditions || []).map(c => `<span class="chip chip-DEFAULT">${esc(c)}</span>`).join('')}
      </div>
    </div>

    <!-- External link -->
    <a class="ext-link" href="https://clinicaltrials.gov/study/${nct}" target="_blank">
      View full record on ClinicalTrials.gov ‚Üí
    </a>

  </div>`;

  document.getElementById('detailPanel').innerHTML = html;
}

// ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ
function esc(s) {
  if (!s) return '';
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

function clearSearch() {
  document.getElementById('kwInput').value = '';
  document.getElementById('condInput').value = '';
  results = [];
  nextPageToken = null;
  totalCount = 0;
  activeNCT = null;
  lastQuery = {};
  document.getElementById('resultsList').innerHTML = `
    <div class="state-box">
      <div class="state-icon">üî¨</div>
      <div class="state-title">Search for leads</div>
      <div class="state-sub">Enter a biomarker keyword above ‚Äî EGFR, ESR1, proteomics ‚Äî or pick a quick keyword from the sidebar.</div>
    </div>`;
  document.getElementById('detailPanel').innerHTML = `
    <div class="detail-empty">
      <div class="detail-empty-icon">‚ó±</div>
      <div class="detail-empty-text">Select a trial to view details</div>
    </div>`;
}

// ‚îÄ‚îÄ Init ‚îÄ‚îÄ
buildSidebar();
document.getElementById('usToggle').classList.add('on');
</script>
</body>
</html>
